<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Anatoly Tsyplenkov">
<meta name="dcterms.date" content="2024-08-06">

<title>Accelerating XGBoost with GPU in R – Anatoly Tsyplenkov</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/academicons-1.9.2/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/academicons-1.9.2/size.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Primary Meta Tags -->

<title>Anatoly Tsyplenkov personal webpage</title>

<meta name="title" content="Anatoly Tsyplenkov personal webpage">

<meta name="description" content="Technical notes about R, sediments and maps.">



<!-- Open Graph / Facebook -->

<meta property="og:type" content="website">

<meta property="og:url" content="https://anatolii.nz/">

<meta property="og:title" content="Accelerating XGBoost with GPU in R – Anatoly Tsyplenkov">

<meta property="og:description" content="Personal website of Anatoly Tsyplenkov">

<meta property="og:image" content="https://anatolii.nz/social-media-logo.webp">



<!-- Twitter -->

<meta property="twitter:card" content="summary_large_image">

<meta property="twitter:url" content="https://anatolii.nz/">

<meta property="twitter:title" content="Anatoly Tsyplenkov personal webpage">

<meta property="twitter:description" content="Technical notes about R, sediments and maps.">

<meta property="twitter:image" content="https://anatolii.nz/social-media-logo.webp">


<meta property="og:title" content="Accelerating XGBoost with GPU in R – Anatoly Tsyplenkov">
<meta property="og:description" content="Update NVIDIA drivers, install the pre-built {xgboost} library with GPU support, and set device = &quot;cuda&quot; while tree_method = &quot;hist&quot;.">
<meta property="og:image" content="https://anatolii.nz/posts/2024/figures/benchmarks.png">
<meta property="og:site_name" content="Anatoly Tsyplenkov">
<meta property="og:image:height" content="960">
<meta property="og:image:width" content="1344">
<meta name="twitter:title" content="Accelerating XGBoost with GPU in R – Anatoly Tsyplenkov">
<meta name="twitter:description" content="Personal website of Anatoly Tsyplenkov">
<meta name="twitter:image" content="https://anatolii.nz/posts/2024/figures/benchmarks.png">
<meta name="twitter:creator" content="@atsyplen">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="960">
<meta name="twitter:image-width" content="1344">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Anatoly Tsyplenkov</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks.html"> 
<span class="menu-text">Talks</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../papers.html"> 
<span class="menu-text">Papers</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/atsyplenkov"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@atsyplenkov"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/atsyplen"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/atsyplenkov/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://scholar.google.com/citations?user=IcwW-WAAAAAJ&amp;hl=en"> 
<span class="menu-text"><i class="ai  ai-google-scholar ai-xl"></i></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">TL;DR</a></li>
  <li><a href="#what-is-xgboost" id="toc-what-is-xgboost" class="nav-link" data-scroll-target="#what-is-xgboost">What is XGBoost?</a></li>
  <li><a href="#installation-instructions" id="toc-installation-instructions" class="nav-link" data-scroll-target="#installation-instructions">Installation instructions</a></li>
  <li><a href="#testing-gpu-support" id="toc-testing-gpu-support" class="nav-link" data-scroll-target="#testing-gpu-support">Testing GPU support</a></li>
  <li><a href="#bonus-kaggle-notebooks" id="toc-bonus-kaggle-notebooks" class="nav-link" data-scroll-target="#bonus-kaggle-notebooks">BONUS: Kaggle <i class="fa-brands fa-kaggle" aria-label="kaggle"></i> notebooks</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Accelerating XGBoost with GPU in R</h1>
  <div class="quarto-categories">
    <div class="quarto-category">R</div>
    <div class="quarto-category">gpu</div>
    <div class="quarto-category">xgboost</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author"><a href="https://anatolii.nz/">Anatoly Tsyplenkov</a> <a href="https://orcid.org/0000-0003-4144-8402" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Manaaki Whenua – Landcare Research
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 6, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="tldr" class="level1">
<h1>TL;DR</h1>
<p>Update NVIDIA drivers, install the pre-built <code>{xgboost}</code> library with GPU support, and set <code>device = "cuda"</code> while <code>tree_method = "hist"</code>.</p>
</section>
<section id="what-is-xgboost" class="level1">
<h1>What is XGBoost?</h1>
<p><a href="https://xgboost.readthedocs.io/en/latest/">XGBoost (Extreme Gradient Boosting)</a> is a powerful machine learning library designed for efficient and scalable implementation of gradient boosting algorithms. It’s a perfect example of a cross-language library, available for Python, Julia, and R. Key features include parallel processing, handling missing values, and regularization to prevent overfitting. <a href="https://xgboost.readthedocs.io/en/latest/R-package/xgboostPresentation.html#introduction">According to the developers</a>, <code>{xgboost}</code> models have been used to win several Kaggle <i class="fa-brands fa-kaggle" aria-label="kaggle"></i> competitions!</p>
<p>However, the most interesting feature is that <code>{xgboost}</code> is one of <a href="https://jaredlander.com/content/2021/09/GPUComputingWithR.html#1">the few R packages</a> that supports GPU computing with R.</p>
</section>
<section id="installation-instructions" class="level1 page-columns page-full">
<h1>Installation instructions</h1>
<p>According to the official documentation of the <code>{xgboost}</code> library, to run GPU-accelerated models in R, one must download and install the <a href="https://xgboost.readthedocs.io/en/latest/install.html#r"><strong>experimental pre-built binary with GPU support</strong></a> (i.e., not the CRAN version!). Currently, they exist only for Windows <i class="fa-brands fa-windows" aria-label="windows"></i> and Linux <i class="fa-brands fa-linux" aria-label="linux"></i>. They are not built with every release, so it’s a good practice to monitor <a href="https://github.com/dmlc/xgboost/releases">GitHub’s release</a> page for new binaries. While I am writing this post, the <code>2.0.3</code> version is the latest with GPU support for R.</p>
<p>Currently, only NVIDIA GPUs <a href="https://xgboost.readthedocs.io/en/latest/gpu/index.html">are supported</a>. So, in a nutshell, prerequisites are as follows:</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisites:
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Linux <i class="fa-brands fa-debian" aria-label="debian"></i> / <i class="fa-brands fa-ubuntu" aria-label="ubuntu"></i> or Windows <i class="fa-brands fa-windows" aria-label="windows"></i> machine</li>
<li>NVIDIA videocard</li>
</ol>
</div>
</div>
<p>Depending on your operating system, installation instructions may vary. While it is quite straightforward for Windows and Linux, running <code>{xgboost}</code> with GPU on WSL2 <em>may</em> require some additional steps.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset page-columns page-full">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Linux <i class="fa-brands fa-debian" aria-label="debian"></i> / <i class="fa-brands fa-ubuntu" aria-label="ubuntu"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Windows <i class="fa-brands fa-windows" aria-label="windows"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">WSL2 <i class="fa-brands fa-linux" aria-label="linux"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">NixOS ❄</a></li></ul>
<div class="tab-content page-columns page-full">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>No additional tinkering is required; just be sure that you have installed <a href="https://www.nvidia.com/en-us/drivers/unix/">the latest NVIDIA</a> drivers on your system.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>xgboost_url <span class="ot">&lt;-</span> <span class="st">"https://s3-us-west-2.amazonaws.com/xgboost-nightly-builds/release_2.0.0/xgboost_r_gpu_linux_82d846bbeb83c652a0b1dff0e3519e67569c4a3d.tar.gz"</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">install.packages</span>(xgboost_url, <span class="at">repos =</span> <span class="cn">NULL</span>, <span class="at">type =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane page-columns page-full" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Make sure that the NVIDIA drivers are up to date. I found <a href="https://www.techpowerup.com/download/techpowerup-nvcleanstall/">NVCleaninstall</a> extremely helpful and easy for updating drivers.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><a href="figures/NVCleanstall_escFw822lQ.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="NVCleaninstall screenshot. Only display driver is required."><img src="figures/NVCleanstall_escFw822lQ.png" class="img-fluid figure-img" style="width:50.0%" alt="NVCleaninstall screenshot. Only display driver is required."></a></p>
<figcaption class="margin-caption">NVCleaninstall screenshot. Only display driver is required.</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>xgboost_url <span class="ot">&lt;-</span> <span class="st">"https://s3-us-west-2.amazonaws.com/xgboost-nightly-builds/release_2.0.0/xgboost_r_gpu_win64_82d846bbeb83c652a0b1dff0e3519e67569c4a3d.tar.gz"</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">install.packages</span>(xgboost_url, <span class="at">repos =</span> <span class="cn">NULL</span>, <span class="at">type =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane page-columns page-full" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>By default, WSL2 should have access to your GPU. You can check this by running <code>nvidia-smi</code> in your terminal. If you see something similar to this, you are all set:</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><a href="figures/WindowsTerminal_kTF31RPuRA.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Checking that WSL2 have access to GPU."><img src="figures/WindowsTerminal_kTF31RPuRA.png" class="img-fluid figure-img" style="width:50.0%" alt="Checking that WSL2 have access to GPU."></a></p>
<figcaption class="margin-caption">Checking that WSL2 have access to GPU.</figcaption>
</figure>
</div>
<p>If not, try installing <em>CUDA Toolkit</em> following this instructions:</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
CUDA Toolkit
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One may also be interested in installing the CUDA Toolkit. <a href="https://youtu.be/JaHVsZa2jTc?si=b9juw5AJTfrsiH2z">This video</a> is a step-by-step tutorial on how to install WSL and the CUDA Toolkit. Be aware that only Debian-based WSL distros are currently supported.</p>
<div class="quarto-video ratio ratio-21x9"><iframe data-external="1" src="https://www.youtube.com/embed/JaHVsZa2jTc?si=b9juw5AJTfrsiH2z" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>xgboost_url <span class="ot">&lt;-</span> <span class="st">"https://s3-us-west-2.amazonaws.com/xgboost-nightly-builds/release_2.0.0/xgboost_r_gpu_linux_82d846bbeb83c652a0b1dff0e3519e67569c4a3d.tar.gz"</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">install.packages</span>(xgboost_url, <span class="at">repos =</span> <span class="cn">NULL</span>, <span class="at">type =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<p>Via <a href="https://github.com/b-rodrigues/xgboost-gpu-nix">nix shell</a>, created by Bruno Rodrigues.</p>
</div>
</div>
</div>
</section>
<section id="testing-gpu-support" class="level1">
<h1>Testing GPU support</h1>
<p>Actually, the <code>{xgboost}</code> developers have <a href="https://github.com/dmlc/xgboost/tree/master/R-package/demo">a lot of demo scripts</a> showing how to use the R package properly. Below, I am using a slightly updated <a href="https://github.com/dmlc/xgboost/blob/master/R-package/demo/gpu_accelerated.R"><code>gpu_accelerated.R</code></a> as an example.</p>
<p>While there <a href="https://jaredlander.com/content/2021/09/GPUComputingWithR.html#71">is some evidence</a> that <code>{tidymodels}</code> can run <code>{xgboost}</code> on GPU, I failed to do so. I had the impression that the issue lies in the <code>xgb.DMatrix</code> class, which is required for <code>{xgboost}</code> to distribute computations on the GPU properly, but maybe I am wrong.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">library</span>(tictoc)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># Simulate N x p random matrix with some binomial response dependent on pp columns</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>N <span class="ot">&lt;-</span> <span class="dv">1000000</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>p <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>pp <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">runif</span>(N <span class="sc">*</span> p), <span class="at">ncol =</span> p)</span>
<span id="cb4-10"><a href="#cb4-10"></a>betas <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">runif</span>(pp) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>sel <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">sample</span>(p, pp))</span>
<span id="cb4-12"><a href="#cb4-12"></a>m <span class="ot">&lt;-</span> X[, sel] <span class="sc">%*%</span> betas <span class="sc">-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">rnorm</span>(N)</span>
<span id="cb4-13"><a href="#cb4-13"></a>y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="dv">1</span>, <span class="fu">plogis</span>(m))</span>
<span id="cb4-14"><a href="#cb4-14"></a></span>
<span id="cb4-15"><a href="#cb4-15"></a>tr <span class="ot">&lt;-</span> <span class="fu">sample.int</span>(N, N <span class="sc">*</span> <span class="fl">0.75</span>)</span>
<span id="cb4-16"><a href="#cb4-16"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(X[tr, ], <span class="at">label =</span> y[tr])</span>
<span id="cb4-17"><a href="#cb4-17"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(X[<span class="sc">-</span>tr, ], <span class="at">label =</span> y[<span class="sc">-</span>tr])</span>
<span id="cb4-18"><a href="#cb4-18"></a>evals <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">train =</span> dtrain, <span class="at">test =</span> dtest)</span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co"># Create parameter sets</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>param <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb4-22"><a href="#cb4-22"></a>  <span class="at">objective =</span> <span class="st">"reg:logistic"</span>,</span>
<span id="cb4-23"><a href="#cb4-23"></a>  <span class="at">eval_metric =</span> <span class="st">"error"</span>,</span>
<span id="cb4-24"><a href="#cb4-24"></a>  <span class="at">eval_metric =</span> <span class="st">"logloss"</span>,</span>
<span id="cb4-25"><a href="#cb4-25"></a>  <span class="at">max_depth =</span> <span class="dv">2</span>,</span>
<span id="cb4-26"><a href="#cb4-26"></a>  <span class="at">eta =</span> <span class="dv">1</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-simple callout-important">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The key thing is, that since <code>{xgboost}</code> v2.0.0 one have to use <code>watchlist</code> instead of <code>evals</code> and specify <code>device</code> parameter.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># Ordinary model</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">tic</span>()</span>
<span id="cb5-3"><a href="#cb5-3"></a>xgb_norm <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="at">params =</span> param,</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="at">data =</span> dtrain,</span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="at">watchlist =</span> evals,</span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>  <span class="at">tree_method =</span> <span class="st">"hist"</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>)</span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6.67 sec elapsed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># GPU model</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">tic</span>()</span>
<span id="cb7-3"><a href="#cb7-3"></a>xgb_gpu <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="at">params =</span> param,</span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="at">data =</span> dtrain,</span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="at">watchlist =</span> evals,</span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="at">tree_method =</span> <span class="st">"hist"</span>,</span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="at">device =</span> <span class="st">"cuda"</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>)</span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1.35 sec elapsed</code></pre>
</div>
</div>
<p>That is! I have <strong>a ≈6x speed increase</strong> while testing it on WSL2.</p>
<div class="cell">
<details class="code-fold">
<summary>ggplot2 setup</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="fu">library</span>(hrbrthemes)</span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="fu">library</span>(showtext)</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="fu">font_add_google</span>(<span class="st">"Ubuntu Condensed"</span>, <span class="st">"Ubuntu Condensed"</span>)</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="fu">showtext_opts</span>(<span class="at">dpi =</span> <span class="dv">300</span>)</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="fu">theme_set</span>(</span>
<span id="cb9-12"><a href="#cb9-12"></a>  hrbrthemes<span class="sc">::</span><span class="fu">theme_ft_rc</span>(</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="at">axis =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="at">base_family =</span> <span class="st">"Ubuntu Condensed"</span>,</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="at">base_size =</span> <span class="dv">12</span>,</span>
<span id="cb9-16"><a href="#cb9-16"></a>    <span class="at">axis_title_size =</span> <span class="dv">10</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>  ) <span class="sc">+</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>    <span class="fu">theme</span>(</span>
<span id="cb9-19"><a href="#cb9-19"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb9-20"><a href="#cb9-20"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb9-21"><a href="#cb9-21"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb9-22"><a href="#cb9-22"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb9-23"><a href="#cb9-23"></a>      <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb9-24"><a href="#cb9-24"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>),</span>
<span id="cb9-25"><a href="#cb9-25"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>)</span>
<span id="cb9-26"><a href="#cb9-26"></a>    )</span>
<span id="cb9-27"><a href="#cb9-27"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Benchmark code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">library</span>(bench)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>gpu_benchs <span class="ot">&lt;-</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>  bench<span class="sc">::</span><span class="fu">mark</span>(</span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="at">GPU =</span> <span class="fu">xgb.train</span>(</span>
<span id="cb10-6"><a href="#cb10-6"></a>      <span class="at">params =</span> param,</span>
<span id="cb10-7"><a href="#cb10-7"></a>      <span class="at">data =</span> dtrain,</span>
<span id="cb10-8"><a href="#cb10-8"></a>      <span class="at">watchlist =</span> evals,</span>
<span id="cb10-9"><a href="#cb10-9"></a>      <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb10-10"><a href="#cb10-10"></a>      <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb10-11"><a href="#cb10-11"></a>      <span class="at">tree_method =</span> <span class="st">"hist"</span>,</span>
<span id="cb10-12"><a href="#cb10-12"></a>      <span class="at">device =</span> <span class="st">"cuda"</span></span>
<span id="cb10-13"><a href="#cb10-13"></a>    ),</span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="at">CPU =</span> <span class="fu">xgb.train</span>(</span>
<span id="cb10-15"><a href="#cb10-15"></a>      <span class="at">params =</span> param,</span>
<span id="cb10-16"><a href="#cb10-16"></a>      <span class="at">data =</span> dtrain,</span>
<span id="cb10-17"><a href="#cb10-17"></a>      <span class="at">watchlist =</span> evals,</span>
<span id="cb10-18"><a href="#cb10-18"></a>      <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb10-19"><a href="#cb10-19"></a>      <span class="at">verbose =</span> <span class="dv">0</span>,</span>
<span id="cb10-20"><a href="#cb10-20"></a>      <span class="at">tree_method =</span> <span class="st">"hist"</span></span>
<span id="cb10-21"><a href="#cb10-21"></a>    ),</span>
<span id="cb10-22"><a href="#cb10-22"></a>    <span class="at">relative =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-23"><a href="#cb10-23"></a>    <span class="at">check =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-24"><a href="#cb10-24"></a>    <span class="at">iterations =</span> <span class="dv">10</span>L</span>
<span id="cb10-25"><a href="#cb10-25"></a>  )</span>
<span id="cb10-26"><a href="#cb10-26"></a></span>
<span id="cb10-27"><a href="#cb10-27"></a><span class="fu">tibble</span>(</span>
<span id="cb10-28"><a href="#cb10-28"></a>  <span class="at">device =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"GPU"</span>, <span class="st">"CPU"</span>), <span class="at">each =</span> <span class="fu">length</span>(gpu_benchs<span class="sc">$</span>time[[<span class="dv">1</span>]])),</span>
<span id="cb10-29"><a href="#cb10-29"></a>  <span class="at">time =</span> <span class="fu">unlist</span>(gpu_benchs<span class="sc">$</span>time)</span>
<span id="cb10-30"><a href="#cb10-30"></a>) <span class="sc">|&gt;</span></span>
<span id="cb10-31"><a href="#cb10-31"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> device, <span class="at">x =</span> time)) <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32"></a>  <span class="fu">stat_pointinterval</span>(</span>
<span id="cb10-33"><a href="#cb10-33"></a>    <span class="fu">aes</span>(<span class="at">color =</span> device),</span>
<span id="cb10-34"><a href="#cb10-34"></a>    <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb10-35"><a href="#cb10-35"></a>  ) <span class="sc">+</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#dd1c05"</span>, <span class="st">"#ebcc2a"</span>)) <span class="sc">+</span></span>
<span id="cb10-37"><a href="#cb10-37"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb10-38"><a href="#cb10-38"></a>    <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">6</span>)</span>
<span id="cb10-39"><a href="#cb10-39"></a>  ) <span class="sc">+</span></span>
<span id="cb10-40"><a href="#cb10-40"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-41"><a href="#cb10-41"></a>    <span class="at">x =</span> <span class="st">"Time elapsed, sec"</span>,</span>
<span id="cb10-42"><a href="#cb10-42"></a>    <span class="at">y =</span> <span class="st">"Device"</span></span>
<span id="cb10-43"><a href="#cb10-43"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="xgboost-gpu-r_files/figure-html/benchmarks-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="xgboost-gpu-r_files/figure-html/benchmarks-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bonus-kaggle-notebooks" class="level1">
<h1>BONUS: Kaggle <i class="fa-brands fa-kaggle" aria-label="kaggle"></i> notebooks</h1>
<p>The Kaggle kernel already comes equipped with the <code>{xgboost}</code> library from CRAN. Therefore, the pre-installed <code>{xgboost}</code> <strong>does not have GPU</strong> support. First, we need to initialize <code>renv</code> to isolate our notebook environment. Using <code>renv</code> is the easiest but not the fastest way to do this, as we will need to download and install all the other packages required for our modeling, which may take some time.</p>
<p>Apart from that, running GPU-accelerated models is not that different from a Linux server. Just don’t forget to set <code>device="cuda"</code>, enable <code>GPU T4×2</code> acceleration support, and have fun!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Example kaggle <i class="fa-brands fa-kaggle" aria-label="kaggle"></i> notebook
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://www.kaggle.com/code/anatoliitsyplenkov/gpu-accelerated-xgboost-in-r">https://www.kaggle.com/code/anatoliitsyplenkov/gpu-accelerated-xgboost-in-r</a></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Install {renv} package</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">install.packages</span>(<span class="st">"renv"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="co"># Initialise {renv} environment</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>renv<span class="sc">::</span><span class="fu">init</span>()</span>
<span id="cb11-6"><a href="#cb11-6"></a>renv<span class="sc">::</span><span class="fu">activate</span>()</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a><span class="co"># Install {xgboost} dependencies</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>renv<span class="sc">::</span><span class="fu">install</span>(<span class="fu">c</span>(<span class="st">"jsonlite"</span>, <span class="st">"data.table"</span>))</span>
<span id="cb11-10"><a href="#cb11-10"></a></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co"># Install the {xgboost} package</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>xgboost_url <span class="ot">&lt;-</span> <span class="st">"https://s3-us-west-2.amazonaws.com/xgboost-nightly-builds/release_2.0.0/xgboost_r_gpu_linux_82d846bbeb83c652a0b1dff0e3519e67569c4a3d.tar.gz"</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="fu">install.packages</span>(xgboost_url, <span class="at">repos =</span> <span class="cn">NULL</span>, <span class="at">type =</span> <span class="st">"source"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{tsyplenkov2024,
  author = {Tsyplenkov, Anatoly},
  title = {Accelerating {XGBoost} with {GPU} in {R}},
  date = {2024-08-06},
  url = {https://anatolii.nz/posts/2024/xgboost-gpu-r.html},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-tsyplenkov2024" class="csl-entry quarto-appendix-citeas" role="listitem">
Tsyplenkov, Anatoly. 2024. <span>“Accelerating XGBoost with GPU in
R.”</span> August 6, 2024. <a href="https://anatolii.nz/posts/2024/xgboost-gpu-r.html">https://anatolii.nz/posts/2024/xgboost-gpu-r.html</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/anatolii\.nz");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="atsyplenkov/quarto-blog" data-repo-id="R_kgDOH2LBBQ" data-category="General" data-category-id="DIC_kwDOH2LBBc4CQ6s3" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2020-2024 Anatoly Tsyplenkov</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-sa" aria-label="creative-commons-sa"></i> Creative Commons CC BY-SA 4.0</a></span></p>
</div>   
    <div class="nav-footer-center">
<p><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/atsyplenkov/quarto-blog">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></p>
</div>
    <div class="nav-footer-right">
<p><span class="faux-block"> <a href="../..\index.xml"><i class="fa-solid fa-rss" aria-label="rss"></i></a></span> <span class="faux-block"> <a href="mailto:atsyplenkov@gmail.com"><i class="fa-solid fa-envelope" aria-label="envelope"></i></a></span></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","openEffect":"zoom","loop":false,"selector":".lightbox","closeEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>